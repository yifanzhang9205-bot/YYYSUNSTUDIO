# IndexedDB 存储升级 - 测试指南

## ✅ 升级已完成！

开发服务器正在运行：http://localhost:3000/

---

## 快速测试步骤

### 1. 基础功能测试（5 分钟）

#### 测试 1：生成图片
1. 打开应用：http://localhost:3000/
2. 创建一个"文字生图"节点
3. 输入提示词，点击生成
4. **预期结果**：
   - 图片正常显示
   - 控制台显示：`[Xiguapi] 下载图片并转换为 base64...`
   - 控制台显示：`[IndexedDB] 保存成功`

#### 测试 2：刷新页面
1. 刷新浏览器（F5）
2. **预期结果**：
   - 应用快速启动（1-2 秒）
   - 之前生成的图片正常显示
   - 控制台显示：`[IndexedDB] 读取成功`

#### 测试 3：图生图
1. 创建一个新的"文字生图"节点
2. 连接到之前生成的图片节点
3. 输入提示词，点击生成
4. **预期结果**：
   - 图生图正常工作
   - 控制台显示：`[ImgBB] 上传成功`
   - 新图片保存到 IndexedDB

---

### 2. 性能测试（10 分钟）

#### 测试 4：批量生成
1. 生成 10 张图片
2. 观察内存使用情况（任务管理器）
3. **预期结果**：
   - 内存占用稳定（不会持续增长）
   - 应用不卡顿
   - 所有图片正常显示

#### 测试 5：启动速度
1. 生成 10-20 张图片
2. 关闭浏览器
3. 重新打开应用
4. **预期结果**：
   - 启动时间 < 3 秒
   - 所有图片正常加载

---

### 3. 高级功能测试（可选）

#### 测试 6：多角度相机
1. 创建"多角度相机"节点
2. 连接一张图片
3. 调整角度，生成九宫格
4. **预期结果**：
   - 九宫格图片保存到 IndexedDB
   - 可以正常使用

#### 测试 7：九宫格处理
1. 创建"九宫格处理"节点
2. 上传或连接九宫格图片
3. 双击选择一张
4. **预期结果**：
   - 切割后的图片保存到 IndexedDB
   - 选择功能正常

---

## 查看存储使用情况

### 方法 1：控制台日志
打开浏览器控制台（F12），查找：
```
[IndexedDB] 存储使用情况: {
  used: "XX.XX MB",
  quota: "XXXX.XX MB",
  percentage: "X.XX%"
}
```

### 方法 2：开发者工具
1. 打开开发者工具（F12）
2. Application → Storage → IndexedDB
3. 展开 `YYYSunStudio`
4. 查看 `images`、`videos`、`audio` 存储

---

## 预期性能指标

### 启动速度
| 图片数量 | 预期启动时间 |
|---------|------------|
| 0-10 张 | < 1 秒 |
| 10-50 张 | 1-3 秒 |
| 50-100 张 | 3-5 秒 |
| 100+ 张 | 5-10 秒 |

### 内存占用
| 图片数量 | 预期内存占用 |
|---------|------------|
| 0-10 张 | 100-200 MB |
| 10-50 张 | 200-500 MB |
| 50-100 张 | 500 MB-1 GB |

### 存储空间
| 图片数量 | 预期存储占用 |
|---------|------------|
| 10 张 | ~20 MB |
| 50 张 | ~100 MB |
| 100 张 | ~200 MB |

---

## 常见问题

### Q1：图片显示很慢
**原因**：首次加载需要从 IndexedDB 读取  
**解决**：正常现象，后续会更快（浏览器缓存）

### Q2：控制台有警告
**原因**：TypeScript 类型检查  
**解决**：不影响功能，可以忽略

### Q3：存储空间不足
**原因**：生成了太多图片  
**解决**：
1. 打开开发者工具（F12）
2. Application → IndexedDB → YYYSunStudio
3. 右键 → Delete Database
4. 刷新页面

---

## 对比测试（可选）

### 如果你想对比新旧方案：

#### 旧方案（URL）
1. 切换到旧分支：`git checkout old-branch`
2. 生成 10 张图片
3. 记录启动时间和内存占用

#### 新方案（IndexedDB）
1. 切换回新分支：`git checkout main`
2. 生成 10 张图片
3. 记录启动时间和内存占用

#### 预期对比
- 启动速度：相近（都很快）
- 内存占用：新方案稍高（但可控）
- 图生图速度：新方案更快（0.5 秒）
- 离线使用：新方案可用，旧方案不可用

---

## 成功标志

如果看到以下现象，说明升级成功：

✅ 图片生成后，控制台显示 `[IndexedDB] 保存成功`  
✅ 刷新页面后，图片快速加载  
✅ 生成 10+ 张图片后，应用不卡顿  
✅ 图生图速度比之前快  
✅ 关闭浏览器后，图片仍然保存

---

## 如果遇到问题

### 1. 图片无法保存
**检查**：
- 打开控制台，查看是否有 IndexedDB 错误
- 确认浏览器允许网站存储数据

### 2. 应用很卡
**检查**：
- 查看存储使用情况（是否接近配额）
- 清理旧图片
- 重启浏览器

### 3. 图片丢失
**检查**：
- 是否清除了浏览器缓存
- 是否删除了 IndexedDB 数据库

---

## 下一步

测试完成后，你可以：

1. **继续开发功能**：存储方案已稳定，可以专心优化功能
2. **添加更多节点**：不用担心存储问题
3. **准备商业化**：数据架构已符合商业化要求

---

**祝测试顺利！如果有任何问题，随时告诉我。** 🚀
