# è¥¿ç“œçš® API æ¥å…¥è¯´æ˜

## æ›´æ–°æ—¶é—´
2026-01-21

## æ¥å…¥å†…å®¹

### 1. æ–°å¢æœåŠ¡æ–‡ä»¶
åˆ›å»ºäº† `services/xiguapiService.ts`ï¼Œé›†æˆè¥¿ç“œçš®ï¼ˆXiguapiï¼‰APIã€‚

### 2. API é…ç½®
- **API åœ°å€**: `https://tasks.xiguapi.tech/`
- **API å¯†é’¥**: `w8n-cYYtSMwKtG6ghPyEykfbh8pl`

### 3. æ”¯æŒçš„åŠŸèƒ½

#### å›¾ç‰‡ç”Ÿæˆ
- **æ¨¡å‹**: `nanobananapro`
- **åˆ†è¾¨ç‡**: `1K`ï¼ˆé»˜è®¤ï¼‰
- **å®½é«˜æ¯”**: æ”¯æŒè‡ªå®šä¹‰ï¼ˆå¦‚ `3:4`, `16:9` ç­‰ï¼‰
- **ç”Ÿæˆæ•°é‡**: æ”¯æŒ `num` å‚æ•°æ§åˆ¶ç”Ÿæˆæ•°é‡ï¼ˆ1-4 å¼ ï¼‰
- **å‚è€ƒå›¾ç‰‡**: æ”¯æŒè¾“å…¥å‚è€ƒå›¾ç‰‡ URL

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { generateImage } from './services/xiguapiService';

const images = await generateImage('a girl holding a banana', {
  model: 'nanobananapro',
  resolution: '1K',
  aspectRatio: '3:4',
  num: 2, // ç”Ÿæˆ 2 å¼ å›¾ç‰‡
  referenceUrls: ['https://example.com/image.png']
});
```

#### è§†é¢‘ç”Ÿæˆ
- **æ¨¡å‹**: `hailuo`
- **æ¨¡å¼**: `01` æˆ– `02`ï¼ˆé»˜è®¤ `02`ï¼‰
- **åˆ†è¾¨ç‡**: `720P` æˆ– `1080P`ï¼ˆé»˜è®¤ `1080P`ï¼‰
- **å®½é«˜æ¯”**: æ”¯æŒè‡ªå®šä¹‰ï¼ˆå¦‚ `16:9`, `9:16` ç­‰ï¼‰
- **èµ·å§‹å¸§**: æ”¯æŒè¾“å…¥èµ·å§‹å¸§å›¾ç‰‡ URL

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { generateVideo } from './services/xiguapiService';

const result = await generateVideo('a cinematic shot of a futuristic city', {
  aspectRatio: '16:9',
  resolution: '1080P',
  hailuoMode: '02',
  referenceImageUrl: 'https://example.com/start_frame.png'
});

console.log('è§†é¢‘ URL:', result.uri);
```

### 4. å·¥ä½œæµç¨‹

#### å›¾ç‰‡ç”Ÿæˆæµç¨‹
1. è°ƒç”¨ `generateImage()` æäº¤ä»»åŠ¡
2. API è¿”å›ä»»åŠ¡ ID
3. è‡ªåŠ¨è½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆæ¯ 2 ç§’ï¼‰
4. ä»»åŠ¡å®Œæˆåè¿”å›å›¾ç‰‡ URL æ•°ç»„

#### è§†é¢‘ç”Ÿæˆæµç¨‹
1. è°ƒç”¨ `generateVideo()` æäº¤ä»»åŠ¡
2. API è¿”å›ä»»åŠ¡ ID
3. è‡ªåŠ¨è½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆæ¯ 3 ç§’ï¼Œæœ€å¤šç­‰å¾… 6 åˆ†é’Ÿï¼‰
4. ä»»åŠ¡å®Œæˆåè¿”å›è§†é¢‘ URL

### 5. é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

#### å›¾ç‰‡ç”Ÿæˆé›†æˆ
ä¿®æ”¹äº† `services/geminiService.ts` ä¸­çš„ `generateImageFromText()` å‡½æ•°ï¼š
- **ä¼˜å…ˆä½¿ç”¨**: è¥¿ç“œçš® API
- **å¤‡ç”¨æ–¹æ¡ˆ**: Gemini APIï¼ˆå¦‚æœè¥¿ç“œçš®å¤±è´¥ï¼‰

#### è§†é¢‘ç”Ÿæˆé›†æˆ
ä¿®æ”¹äº† `services/geminiService.ts` ä¸­çš„ `generateVideo()` å‡½æ•°ï¼š
- **ä¼˜å…ˆä½¿ç”¨**: è¥¿ç“œçš® Hailuo API
- **å¤‡ç”¨æ–¹æ¡ˆ 1**: Gemini Veo APIï¼ˆå¦‚æœè¥¿ç“œçš®å¤±è´¥ï¼‰
- **å¤‡ç”¨æ–¹æ¡ˆ 2**: ç”Ÿæˆé™æ€å›¾ç‰‡ï¼ˆå¦‚æœè§†é¢‘ç”Ÿæˆéƒ½å¤±è´¥ï¼‰

### 6. é”™è¯¯å¤„ç†

#### å‹å¥½é”™è¯¯æç¤º
- `401/Unauthorized`: API å¯†é’¥æ— æ•ˆ
- `429/rate_limit`: è¯·æ±‚è¿‡äºé¢‘ç¹
- `quota`: API é…é¢ä¸è¶³
- `timeout`: ç”Ÿæˆè¶…æ—¶

#### è‡ªåŠ¨é‡è¯•
- å›¾ç‰‡ç”Ÿæˆï¼šæœ€å¤šç­‰å¾… 2 åˆ†é’Ÿï¼ˆ60 æ¬¡ Ã— 2 ç§’ï¼‰
- è§†é¢‘ç”Ÿæˆï¼šæœ€å¤šç­‰å¾… 6 åˆ†é’Ÿï¼ˆ120 æ¬¡ Ã— 3 ç§’ï¼‰

### 7. æ‰¹é‡ç”Ÿæˆ

#### æ‰¹é‡å›¾ç‰‡ç”Ÿæˆ
```typescript
import { generateMultipleImages } from './services/xiguapiService';

const images = await generateMultipleImages('a beautiful landscape', 4, {
  aspectRatio: '16:9',
  resolution: '1K'
});
// è¿”å› 4 å¼ å›¾ç‰‡çš„ URL æ•°ç»„
```

#### æ‰¹é‡è§†é¢‘ç”Ÿæˆ
```typescript
import { generateMultipleVideos } from './services/xiguapiService';

const videos = await generateMultipleVideos('a cinematic scene', 2, {
  aspectRatio: '16:9',
  resolution: '1080P'
});
// è¿”å› 2 ä¸ªè§†é¢‘çš„ URL æ•°ç»„
```

### 8. API å“åº”æ ¼å¼

#### åˆ›å»ºä»»åŠ¡å“åº”
```json
{
  "code": 200,
  "status": "running",
  "taskid": "e4b8a1c9-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}
```

#### æŸ¥è¯¢ä»»åŠ¡å“åº”
```json
{
  "success": true,
  "status": "success",
  "result": {
    "images": ["https://image-upload.xiguapi.tech/creation/generated/..."]
  },
  "message": "Task already finalized"
}
```

### 9. æ³¨æ„äº‹é¡¹

1. **API å¯†é’¥å®‰å…¨**: å¯†é’¥å·²ç¡¬ç¼–ç åœ¨ `xiguapiService.ts` ä¸­ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡
2. **å›¾ç‰‡è¾“å…¥é™åˆ¶**: è¥¿ç“œçš® API çš„ `image_urls` å‚æ•°éœ€è¦å›¾ç‰‡ URLï¼Œä¸æ”¯æŒ base64 æ ¼å¼
   - **çº¯æ–‡æœ¬ç”Ÿå›¾**: ä½¿ç”¨è¥¿ç“œçš® API âœ…
   - **å›¾ç”Ÿå›¾ï¼ˆä¸Šä¼ å›¾ç‰‡ï¼‰**: è‡ªåŠ¨ä½¿ç”¨ Gemini API âœ…
3. **è½®è¯¢é¢‘ç‡**: å½“å‰è®¾ç½®ä¸ºå›¾ç‰‡ 2 ç§’ã€è§†é¢‘ 3 ç§’ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
4. **è¶…æ—¶æ—¶é—´**: å›¾ç‰‡ 2 åˆ†é’Ÿã€è§†é¢‘ 6 åˆ†é’Ÿï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´

### 10. åç»­ä¼˜åŒ–å»ºè®®

1. **ç¯å¢ƒå˜é‡é…ç½®**: å°† API å¯†é’¥ç§»åˆ° `.env.local` æ–‡ä»¶
2. **å›¾ç‰‡ä¸Šä¼ **: å®ç° base64 å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œæ”¯æŒæœ¬åœ°å›¾ç‰‡ä½œä¸ºå‚è€ƒ
3. **è¿›åº¦å›è°ƒ**: æ·»åŠ ç”Ÿæˆè¿›åº¦å›è°ƒï¼Œå®æ—¶æ˜¾ç¤ºç”ŸæˆçŠ¶æ€
4. **ç¼“å­˜æœºåˆ¶**: å¯¹ç›¸åŒæç¤ºè¯çš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘ API è°ƒç”¨
5. **é˜Ÿåˆ—ç®¡ç†**: å®ç°ä»»åŠ¡é˜Ÿåˆ—ï¼Œé¿å…å¹¶å‘è¯·æ±‚è¿‡å¤š

## æµ‹è¯•å»ºè®®

### å›¾ç‰‡ç”Ÿæˆæµ‹è¯•
1. åœ¨åº”ç”¨ä¸­åˆ›å»º"æ–‡å­—ç”Ÿå›¾"èŠ‚ç‚¹
2. è¾“å…¥æç¤ºè¯ï¼Œå¦‚ï¼š"a girl holding a banana"
3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤ä½¿ç”¨è¥¿ç“œçš® API
4. æ£€æŸ¥ç”Ÿæˆçš„å›¾ç‰‡è´¨é‡

### è§†é¢‘ç”Ÿæˆæµ‹è¯•
1. åœ¨åº”ç”¨ä¸­åˆ›å»º"æ–‡ç”Ÿè§†é¢‘"èŠ‚ç‚¹
2. è¾“å…¥æç¤ºè¯ï¼Œå¦‚ï¼š"a cinematic shot of a futuristic city"
3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤ä½¿ç”¨è¥¿ç“œçš® Hailuo API
4. ç­‰å¾…è§†é¢‘ç”Ÿæˆå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
5. æ£€æŸ¥ç”Ÿæˆçš„è§†é¢‘è´¨é‡

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

- âœ… æ–°å¢: `services/xiguapiService.ts` - è¥¿ç“œçš® API æœåŠ¡
- âœ… ä¿®æ”¹: `services/geminiService.ts` - é›†æˆè¥¿ç“œçš® APIï¼Œæ·»åŠ å¤‡ç”¨æ–¹æ¡ˆ
- âœ… æ–°å¢: `è¥¿ç“œçš®APIæ¥å…¥è¯´æ˜.md` - æœ¬æ–‡æ¡£

## å®ŒæˆçŠ¶æ€

- âœ… å›¾ç‰‡ç”Ÿæˆ API æ¥å…¥
- âœ… è§†é¢‘ç”Ÿæˆ API æ¥å…¥
- âœ… é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶
- âœ… æ‰¹é‡ç”Ÿæˆæ”¯æŒ
- âœ… å¤‡ç”¨æ–¹æ¡ˆï¼ˆGemini APIï¼‰

---

**æ¥å…¥å®Œæˆï¼** ğŸ‰

ç°åœ¨æ‰€æœ‰çš„å›¾ç‰‡å’Œè§†é¢‘ç”Ÿæˆéƒ½ä¼šä¼˜å…ˆä½¿ç”¨è¥¿ç“œçš® APIï¼Œå¦‚æœå¤±è´¥ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° Gemini å¤‡ç”¨æ–¹æ¡ˆã€‚
