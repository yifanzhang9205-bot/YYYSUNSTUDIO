# 多角度相机 3D 视角效果说明

## 技术原理

### CSS 3D Transform
使用纯 CSS 实现真实的 3D 透视效果，无需 Three.js 等 3D 库。

```css
/* 父容器设置透视 */
perspective: 1200px;

/* 子元素保持 3D 空间 */
transform-style: preserve-3d;

/* 3D 变换 */
transform: rotateX(angle) rotateY(angle) translateZ(distance);
```

## 3D 场景结构

### 1. 透视容器
```typescript
<div style={{ height: '400px', perspective: '1200px' }}>
  {/* 3D 内容 */}
</div>
```

- **perspective: 1200px**：设置观察者到 3D 场景的距离
- 数值越小，透视效果越强（变形越明显）
- 数值越大，透视效果越弱（接近正交投影）

### 2. 3D 舞台
```typescript
<div style={{
  transformStyle: 'preserve-3d',
  transform: `rotateX(${-verticalAngle * 0.5}deg) rotateY(${horizontalAngle}deg)`
}}>
  {/* 地面、立方体、坐标轴、相机 */}
</div>
```

- **transformStyle: preserve-3d**：保持子元素的 3D 空间关系
- **rotateX**：绕 X 轴旋转（上下倾斜）
- **rotateY**：绕 Y 轴旋转（左右旋转）

### 3. 地面网格
```typescript
<div style={{
  width: '500px',
  height: '500px',
  transform: 'rotateX(90deg) translateZ(-80px)',
  backgroundImage: 'linear-gradient(...), linear-gradient(...)',
  backgroundSize: '40px 40px'
}} />
```

- **rotateX(90deg)**：将平面旋转 90° 成为地面
- **translateZ(-80px)**：向下移动 80px，放在立方体下方
- **backgroundImage**：使用渐变创建网格线

### 4. 立方体（六面体）
```typescript
// 前面
<div style={{ transform: 'translateZ(60px)' }} />

// 后面
<div style={{ transform: 'translateZ(-60px) rotateY(180deg)' }} />

// 左面
<div style={{ transform: 'rotateY(-90deg) translateZ(60px)' }} />

// 右面
<div style={{ transform: 'rotateY(90deg) translateZ(60px)' }} />

// 上面
<div style={{ transform: 'rotateX(90deg) translateZ(60px)' }} />

// 下面
<div style={{ transform: 'rotateX(-90deg) translateZ(60px)' }} />
```

- 立方体尺寸：120×120×120px
- 每个面距离中心：60px
- 使用不同的旋转和平移组合创建六个面

### 5. 坐标轴
```typescript
// X 轴（红色，水平向右）
<div style={{
  width: '48px',
  height: '1px',
  background: 'linear-gradient(to right, red, transparent)',
  transform: 'translateY(-50%) translateZ(0px)'
}} />

// Y 轴（绿色，垂直向上）
<div style={{
  width: '1px',
  height: '48px',
  background: 'linear-gradient(to bottom, green, transparent)',
  transform: 'translateX(-50%) translateZ(0px)'
}} />

// Z 轴（蓝色，垂直向前）
<div style={{
  width: '1px',
  height: '48px',
  background: 'linear-gradient(to bottom, blue, transparent)',
  transform: 'translate(-50%, -50%) rotateX(90deg)'
}} />
```

- X 轴：红色，指向右侧
- Y 轴：绿色，指向上方
- Z 轴：蓝色，指向前方（观察者）

### 6. 相机位置
```typescript
<div style={{
  transform: `
    translate(-50%, -50%)
    rotateY(${-horizontalAngle}deg)
    rotateX(${verticalAngle}deg)
    translateZ(${180 + cameraZoom * 20}px)
    rotateY(${horizontalAngle}deg)
    rotateX(${-verticalAngle}deg)
  `
}}>
  <Camera />
</div>
```

#### 变换顺序解析
1. **translate(-50%, -50%)**：将相机移到中心点
2. **rotateY(-horizontalAngle)**：反向旋转，抵消场景旋转
3. **rotateX(verticalAngle)**：垂直旋转
4. **translateZ(distance)**：沿 Z 轴移动到指定距离
5. **rotateY(horizontalAngle)**：恢复水平旋转，让相机面向立方体
6. **rotateX(-verticalAngle)**：恢复垂直旋转

## 参数说明

### 水平角度（horizontalAngle）
- **范围**：0° - 360°
- **效果**：绕 Y 轴旋转（左右旋转）
- **预设**：
  - 0° = 正面
  - 45° = 右前
  - 90° = 右侧
  - 135° = 右后
  - 180° = 背面
  - 225° = 左后
  - 270° = 左侧
  - 315° = 左前

### 垂直角度（verticalAngle）
- **范围**：-30° - 60°
- **效果**：绕 X 轴旋转（上下倾斜）
- **预设**：
  - -30° = 低角度（从下往上看）
  - 0° = 平视
  - 30° = 仰角
  - 60° = 高角度（从上往下看）

### 相机距离（cameraZoom）
- **范围**：0 - 10
- **效果**：相机到立方体的距离
- **计算**：`180 + cameraZoom * 20` px
- **预设**：
  - 2 = 特写（220px）
  - 5 = 中景（280px）
  - 8 = 远景（340px）

## 动画效果

### 平滑过渡
```css
transition: transform 0.7s ease-out;
```

- **duration: 0.7s**：动画持续 700 毫秒
- **ease-out**：开始快，结束慢，更自然

### 实时响应
```typescript
// 拖动滑块时立即更新
onHorizontalAngleChange={(value) => onUpdate(node.id, { horizontalAngle: value })}
```

- 无延迟，实时响应
- 平滑过渡，不会跳跃

## 视觉增强

### 1. 光晕效果
```css
/* 地面网格光晕 */
box-shadow: 0 0 40px rgba(168, 85, 247, 0.2);

/* 相机光晕 */
.camera-glow {
  background: purple-500/40;
  border-radius: 50%;
  blur: 2xl;
  animate: pulse;
}
```

### 2. 渐变背景
```css
/* 场景背景 */
background: linear-gradient(to bottom right, 
  from-purple-900/20 to-pink-900/20);

/* 装饰网格 */
background-image: radial-gradient(circle, #a855f7 1px, transparent 1px);
background-size: 20px 20px;
```

### 3. 阴影效果
```css
/* 立方体阴影 */
box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);

/* 相机阴影 */
box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.8);
```

## 性能优化

### 1. CSS 硬件加速
```css
transform: translateZ(0);  /* 触发 GPU 加速 */
will-change: transform;    /* 提示浏览器优化 */
```

### 2. 避免重排
- 只使用 `transform` 和 `opacity`
- 不修改 `width`、`height`、`top`、`left` 等属性

### 3. 合理的过渡时间
- 700ms：足够平滑，不会太慢
- ease-out：更自然的缓动曲线

## 浏览器兼容性

### 支持的浏览器
- ✅ Chrome 36+
- ✅ Firefox 16+
- ✅ Safari 9+
- ✅ Edge 12+

### 不支持的浏览器
- ❌ IE 11 及以下（不支持 `transform-style: preserve-3d`）

### Fallback 方案
如果浏览器不支持 3D Transform，可以：
1. 检测浏览器支持：`CSS.supports('transform-style', 'preserve-3d')`
2. 降级为 2D 视图
3. 显示提示信息

## 调试技巧

### 1. 查看坐标轴
- X 轴（红色）：水平向右
- Y 轴（绿色）：垂直向上
- Z 轴（蓝色）：垂直向前

### 2. 查看相机位置
- 相机图标显示当前位置
- "Camera" 标签标识相机
- 相机视锥显示拍摄方向

### 3. 查看立方体
- 前面有紫色装饰，容易识别
- 其他面颜色略有不同
- 旋转时可以看到不同的面

### 4. 查看地面网格
- 紫色网格线
- 40×40px 网格
- 在立方体下方

## 扩展可能

### 1. 添加更多对象
```typescript
// 人物模型
<div style={{ transform: 'translateX(-100px)' }}>
  <PersonModel />
</div>

// 场景道具
<div style={{ transform: 'translateX(100px)' }}>
  <PropModel />
</div>
```

### 2. 添加光照效果
```css
/* 模拟光照 */
.lit-face {
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.2) 0%, 
    rgba(0,0,0,0.2) 100%);
}
```

### 3. 添加阴影投射
```css
/* 立方体阴影 */
.cube-shadow {
  position: absolute;
  width: 120px;
  height: 120px;
  background: radial-gradient(ellipse, 
    rgba(0,0,0,0.5) 0%, 
    transparent 70%);
  transform: rotateX(90deg) translateZ(-80px);
}
```

### 4. 添加相机路径
```typescript
// 相机路径预览
const cameraPath = [
  { h: 0, v: 0, z: 5 },
  { h: 90, v: 0, z: 5 },
  { h: 180, v: 0, z: 5 },
  { h: 270, v: 0, z: 5 },
];

// 绘制路径线
<path d={generatePathD(cameraPath)} stroke="cyan" />
```

## 总结

### 技术优势
- ✅ 纯 CSS，无需额外库
- ✅ 性能优异，GPU 加速
- ✅ 代码简洁，易于维护
- ✅ 浏览器兼容性好

### 视觉效果
- ✅ 真实的 3D 透视
- ✅ 平滑的动画过渡
- ✅ 清晰的坐标系统
- ✅ 明显的相机位置

### 用户体验
- ✅ 实时响应
- ✅ 直观易懂
- ✅ 功能完整
- ✅ 专业美观
