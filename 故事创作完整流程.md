# 故事创作完整流程 - 使用指南

## 🎬 完整工作流程

```
创意工作室 → 角色参考 → 场景参考 → 分镜生成 → 序列编排 → 视频生成
```

---

## 📦 已完成的 4 个节点

### 1. 创意工作室（Story Studio）
**功能**：输入创意 → 生成完整剧本

**使用方法**：
1. 双击画布 → "故事创作" → "创意工作室"
2. 点击节点选中，展开编辑界面
3. 输入创意灵感
4. 配置风格、时长、镜头数
5. （可选）添加自定义提示词
6. 点击"生成剧本"

**输出**：
- 剧本标题和概要
- 角色列表（名字、描述、性格）
- 场景列表（地点、时间、氛围）
- 镜头列表（景别、角度、动作）

---

### 2. 角色参考（Character Reference）
**功能**：为每个角色生成 9 宫格参考图，用户选择最满意的一张

**使用方法**：
1. 创建"角色参考"节点
2. 从"创意工作室"的**输出端口**连接到"角色参考"的**输入端口**
3. 选中节点，查看角色列表
4. 点击"生成 9 宫格参考图"
5. 从 9 张图中选择 1 张（点击图片）
6. 如果有多个角色，使用左右箭头切换
7. 为每个角色选择参考图

**特点**：
- 9 宫格展示，每张图都是细微变体
- 选中的图片会高亮显示（青色边框）
- 支持重新生成
- 支持自定义补充提示词

---

### 3. 场景参考（Scene Reference）
**功能**：为每个场景生成 9 宫格参考图

**使用方法**：
1. 创建"场景参考"节点
2. 从"创意工作室"的**输出端口**连接到"场景参考"的**输入端口**
3. 选中节点，查看场景信息
4. 点击"生成 9 宫格参考图"
5. 从 9 张图中选择 1 张
6. 如果有多个场景，使用左右箭头切换
7. 为每个场景选择参考图

**特点**：
- 显示场景的地点、时间、氛围
- 紫色主题（区别于角色的青色）
- 支持自定义补充提示词

---

### 4. 分镜生成（Storyboard Shot）
**功能**：基于剧本、角色参考、场景参考，生成 9 宫格分镜图

**使用方法**：
1. 创建"分镜生成"节点
2. 连接输入：
   - 从"创意工作室"连接（获取镜头信息）
   - 从"角色参考"连接（获取角色一致性）
   - 从"场景参考"连接（获取场景风格）
3. 选中节点，查看镜头详情
4. 点击"生成 9 宫格分镜"
5. 从 9 张图中选择最满意的分镜
6. 使用左右箭头切换不同镜头
7. 为每个镜头选择分镜图

**特点**：
- 显示景别、角度、运镜、角色、动作
- 绿色主题
- 支持查看完整生成提示词
- 支持自定义补充提示词
- 支持负面提示词（避免不想要的元素）

---

## 🎯 完整使用示例

### 步骤 1：创建剧本
```
1. 创建"创意工作室"节点
2. 输入创意：
   "一个程序员在深夜加班时，发现了一个神秘的代码，
    这段代码似乎能够预测未来..."
3. 选择风格：科幻
4. 设置时长：30秒
5. 镜头数：6个
6. 点击"生成剧本"
```

### 步骤 2：生成角色参考
```
1. 创建"角色参考"节点
2. 连接：创意工作室 → 角色参考
3. 查看角色列表（例如：李明 - 程序员）
4. 点击"生成 9 宫格参考图"
5. 选择最符合想象的角色形象（例如：第 5 张）
6. 如果有多个角色，切换并为每个角色选择
```

### 步骤 3：生成场景参考
```
1. 创建"场景参考"节点
2. 连接：创意工作室 → 场景参考
3. 查看场景信息（例如：现代办公室 - 深夜 - 神秘）
4. 点击"生成 9 宫格参考图"
5. 选择最符合氛围的场景（例如：第 3 张）
6. 为每个场景选择参考图
```

### 步骤 4：生成分镜
```
1. 创建"分镜生成"节点
2. 连接：
   - 创意工作室 → 分镜生成
   - 角色参考 → 分镜生成
   - 场景参考 → 分镜生成
3. 查看第 1 个镜头信息
4. 点击"生成 9 宫格分镜"
5. 选择最满意的构图（例如：第 7 张）
6. 切换到下一个镜头，重复操作
7. 为所有 6 个镜头选择分镜图
```

### 步骤 5：序列编排（即将支持）
```
1. 创建"序列编排"节点
2. 连接所有分镜节点
3. 在时间轴上排列顺序
4. 设置转场效果
5. 预览完整序列
6. 一键生成视频
```

---

## 💡 UI/UX 特点

### 未选中状态（简洁）
- 只显示关键信息
- 占用空间小
- 便于画布布局

### 选中状态（展开）
- 显示完整编辑界面
- 节点自动调整高度
- 所有功能可用

### 9 宫格选择
- 3x3 网格布局
- 悬停放大预览
- 点击选择
- 选中后显示勾选标记
- 右下角显示编号（1-9）

### 高级选项（可折叠）
- 查看系统提示词
- 添加自定义补充
- 添加负面提示词（仅分镜）
- 查看完整提示词（仅分镜）

---

## 🎨 视觉设计

### 颜色主题
- **创意工作室**：青色 → 紫色渐变
- **角色参考**：青色主题
- **场景参考**：紫色主题
- **分镜生成**：绿色主题

### 图标
- 创意工作室：✨ Sparkles
- 角色参考：👤 Users
- 场景参考：📍 MapPin
- 分镜生成：🎬 Film

---

## 🔄 数据流转

```
创意工作室
  ↓ (输出: storyData)
  ├→ 角色参考
  │   ↓ (输出: characterRefs)
  │   └→ 分镜生成
  │
  └→ 场景参考
      ↓ (输出: sceneRefs)
      └→ 分镜生成
          ↓ (输出: selectedImages)
          └→ 序列编排
```

---

## 📝 数据结构

### StoryData（剧本数据）
```typescript
{
  title: "剧本标题",
  logline: "一句话概要",
  theme: "核心主题",
  characters: [
    {
      id: "char-1",
      name: "李明",
      description: "25岁程序员...",
      personality: "内向、专注",
      visualKeywords: ["黑框眼镜", "T恤"],
      referenceImage: "base64..." // 用户选中的参考图
    }
  ],
  scenes: [
    {
      id: "scene-1",
      sceneNumber: 1,
      location: "现代办公室",
      timeOfDay: "深夜",
      mood: "神秘",
      description: "昏暗的办公室...",
      visualKeywords: ["蓝光", "电脑屏幕"],
      referenceImage: "base64..."
    }
  ],
  shots: [
    {
      id: "shot-1",
      shotNumber: 1,
      sceneNumber: 1,
      shotType: "中景",
      cameraAngle: "平视",
      cameraMovement: "推进",
      duration: 5,
      characters: ["李明"],
      action: "李明坐在电脑前...",
      dialogue: "这段代码...",
      visualDescription: "完整描述",
      imagePrompt: "英文 Prompt"
    }
  ]
}
```

---

## 🚀 下一步开发

### 即将完成：
- [ ] 序列编排节点（时间轴视图）
- [ ] 批量视频生成
- [ ] 导出功能

### API 集成（最后统一）：
- [ ] Gemini API - 剧本生成
- [ ] Nano Banana - 9 宫格图片生成
- [ ] Veo - 视频生成

---

## 🐛 测试建议

1. **测试节点创建**
   - 双击画布 → 查看"故事创作"分类
   - 创建 4 种节点

2. **测试节点连接**
   - 创意工作室 → 角色参考
   - 创意工作室 → 场景参考
   - 多个节点 → 分镜生成

3. **测试 UI 交互**
   - 选中/取消选中节点
   - 节点高度自动调整
   - 高级选项展开/折叠

4. **测试 9 宫格**
   - 点击选择图片
   - 选中状态高亮
   - 重新生成功能

5. **测试多项切换**
   - 角色切换（左右箭头）
   - 场景切换
   - 镜头切换

---

## 💬 反馈

所有 UI 和交互已完成，API 接入留到最后统一处理。
现在可以测试完整的工作流程了！
